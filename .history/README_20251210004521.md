# Xablau Monitoring

PDF page monitoring and counting system with automatic report delivery via WhatsApp.

## Description

This project consists of a complete system to monitor folders containing PDF files, count the number of pages in each folder, and send automatic reports via WhatsApp. The system offers two modes of operation:

- **Manual execution**: Single PDF page count in specific folders
- **Continuous monitoring**: Automatic folder monitoring with real-time change detection

## Features

- PDF page counting across multiple folders
- Parallel processing for better performance
- Automatic folder monitoring with change detection
- Automatic report delivery via WhatsApp (groups or individual contacts)
- Count history with JSON persistence
- Intelligent debounce to avoid unnecessary executions
- Cross-platform support (Windows, Linux, macOS)

## Project Structure

```
XABLAU PROJECT/
├── pagecounter-folders.py    # Main page counting script
├── folder-monitor.py         # Folder monitor with change detection
├── whatsapp-sender.js        # Node.js server for WhatsApp delivery
├── config.json               # Configuration file
├── pagecount_history.json    # Count history
├── requirements.txt          # Python dependencies
├── package.json              # Node.js dependencies
└── README.md                 # This file
```

## Prerequisites

1. **Python 3.x** (3.8 or higher recommended)
2. **Node.js** (version 14 or higher)
3. **npm** (usually comes with Node.js)

## Installation

1. Clone the repository:

   ```bash
   git clone https://github.com/thalesv6/Xablau-Monitoring.git
   cd Xablau-Monitoring
   ```

2. Install Python dependencies:

   ```bash
   pip install -r requirements.txt
   ```

3. Install Node.js dependencies:

   ```bash
   npm install
   ```

## Configuration

Edit the `config.json` file to configure the system:

```json
{
  "whatsapp": {
    "type": "group",
    "target": "Group Name or Number",
    "enabled": true
  },
  "message": {
    "timeout": 30000,
    "min_cooldown_seconds": 60
  },
  "monitor": {
    "delay_seconds": 120,
    "watch_path": "C:/path/to/folder/",
    "enabled": true
  }
}
```

### WhatsApp Configuration

- **To send to a group**:
  - `"type": "group"`
  - `"target": "Exact Group Name"` (the name as it appears in WhatsApp)

- **To send to an individual contact**:
  - `"type": "number"`
  - `"target": "5511999999999"` (country code + number, without spaces or special characters)

- **To disable WhatsApp delivery**:
  - `"enabled": false`

### Monitor Configuration

- `delay_seconds`: Wait time (in seconds) after detecting changes before executing the count
- `watch_path`: Path of the folder to be monitored
- `enabled`: Enable/disable automatic monitoring

### Message Configuration

- `timeout`: Timeout in milliseconds for message delivery
- `min_cooldown_seconds`: Minimum time between message deliveries

## Usage

### Manual Execution

Run the counting script directly:

```bash
python pagecounter-folders.py
```

The script will:

1. Count all PDF pages in each folder
2. Display results in the terminal
3. Automatically send results to the configured WhatsApp (if enabled)

### Automatic Monitoring

To automatically monitor a folder:

```bash
python folder-monitor.py
```

The monitor will:

1. Watch the folder configured in `config.json`
2. Detect changes in PDF files
3. Wait for the configured debounce period
4. Automatically execute page counting
5. Send results via WhatsApp

## First Run (WhatsApp)

On the first run, you will need to authenticate with WhatsApp Web:

1. Run the Python script normally
2. A QR Code will appear in the terminal
3. Open WhatsApp on your phone
4. Go to **Settings > Linked Devices > Link a Device**
5. Scan the QR Code displayed in the terminal
6. The session will be automatically saved in the `.wwebjs_auth/` folder for future runs

## Important Notes

- The first run may take longer due to WhatsApp authentication
- The WhatsApp session is saved in the `.wwebjs_auth/` folder (not committed to git)
- If the group is not found, the script will list available groups
- Count history is saved in `pagecount_history.json`
- The monitor uses debounce to avoid multiple executions when several files are modified simultaneously

## Technologies Used

- **Python**: PDF processing and counting
- **PyPDF2**: Library for reading PDF files
- **watchdog**: File system monitoring
- **Node.js**: Server for WhatsApp integration
- **whatsapp-web.js**: WhatsApp Web client for Node.js

## License

This project is licensed under the ISC License.

## Repository

[GitHub - Xablau Monitoring](https://github.com/thalesv6/Xablau-Monitoring)
